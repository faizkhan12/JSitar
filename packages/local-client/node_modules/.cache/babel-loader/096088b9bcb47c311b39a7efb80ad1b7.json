{"ast":null,"code":"import _regeneratorRuntime from\"/home/faiz/react-tutorial/readme-generator/jstrings/packages/local-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/faiz/react-tutorial/readme-generator/jstrings/packages/local-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import*as esbuild from\"esbuild-wasm\";import{fetchPlugin}from\"./plugins/fetch-plugin\";import{unpkgPathPlugin}from\"./plugins/unpkg-path-plugin\";var service;/**\n * initialize es build for transpiling & bundeling the code\n */var bundle=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(rawCode){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(service){_context.next=4;break;}_context.next=3;return esbuild.startService({worker:true,wasmURL:\"https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm\"});case 3:service=_context.sent;case 4:_context.prev=4;_context.next=7;return service.build({entryPoints:[\"index.js\"],bundle:true,write:false,plugins:[unpkgPathPlugin(),fetchPlugin(rawCode)],define:{\"process.env.NODE_ENV\":'\"production\"',global:\"window\"// automatically done by webpack :(\n},jsxFactory:\"_React.createElement\",jsxFragment:\"_React.Fragment\"});case 7:result=_context.sent;return _context.abrupt(\"return\",{code:result.outputFiles[0].text,err:\"\"});case 11:_context.prev=11;_context.t0=_context[\"catch\"](4);return _context.abrupt(\"return\",{code:\"\",err:_context.t0.message});case 14:case\"end\":return _context.stop();}}},_callee,null,[[4,11]]);}));return function bundle(_x){return _ref.apply(this,arguments);};}();export default bundle;","map":{"version":3,"sources":["/home/faiz/react-tutorial/readme-generator/jstrings/packages/local-client/src/bundler/index.ts"],"names":["esbuild","fetchPlugin","unpkgPathPlugin","service","bundle","rawCode","startService","worker","wasmURL","build","entryPoints","write","plugins","define","global","jsxFactory","jsxFragment","result","code","outputFiles","text","err","message"],"mappings":"6XAAA,MAAO,GAAKA,CAAAA,OAAZ,KAAyB,cAAzB,CACA,OAASC,WAAT,KAA4B,wBAA5B,CACA,OAASC,eAAT,KAAgC,6BAAhC,CAEA,GAAIC,CAAAA,OAAJ,CAEA;AACA;AACA,GACA,GAAMC,CAAAA,MAAM,0FAAG,iBAAOC,OAAP,gIACRF,OADQ,+CAEKH,CAAAA,OAAO,CAACM,YAAR,CAAqB,CACnCC,MAAM,CAAE,IAD2B,CAEnCC,OAAO,CAAE,oDAF0B,CAArB,CAFL,QAEXL,OAFW,4DAYUA,CAAAA,OAAO,CAACM,KAAR,CAAc,CACjCC,WAAW,CAAE,CAAC,UAAD,CADoB,CAEjCN,MAAM,CAAE,IAFyB,CAGjCO,KAAK,CAAE,KAH0B,CAIjCC,OAAO,CAAE,CAACV,eAAe,EAAhB,CAAoBD,WAAW,CAACI,OAAD,CAA/B,CAJwB,CAKjCQ,MAAM,CAAE,CACN,uBAAwB,cADlB,CAENC,MAAM,CAAE,QAAU;AAFZ,CALyB,CASjCC,UAAU,CAAE,sBATqB,CAUjCC,WAAW,CAAE,iBAVoB,CAAd,CAZV,QAYLC,MAZK,+CAwBJ,CACLC,IAAI,CAAED,MAAM,CAACE,WAAP,CAAmB,CAAnB,EAAsBC,IADvB,CAELC,GAAG,CAAE,EAFA,CAxBI,4FA6BJ,CACLH,IAAI,CAAE,EADD,CAELG,GAAG,CAAE,YAAIC,OAFJ,CA7BI,uEAAH,kBAANlB,CAAAA,MAAM,4CAAZ,CAoCA,cAAeA,CAAAA,MAAf","sourcesContent":["import * as esbuild from \"esbuild-wasm\"\nimport { fetchPlugin } from \"./plugins/fetch-plugin\"\nimport { unpkgPathPlugin } from \"./plugins/unpkg-path-plugin\"\n\nlet service: esbuild.Service\n\n/**\n * initialize es build for transpiling & bundeling the code\n */\nconst bundle = async (rawCode: string) => {\n  if (!service) {\n    service = await esbuild.startService({\n      worker: true,\n      wasmURL: \"https://unpkg.com/esbuild-wasm@0.8.27/esbuild.wasm\",\n    })\n  }\n\n  /**\n   * This is where we bundled our data :)\n   */\n  try {\n    const result = await service.build({\n      entryPoints: [\"index.js\"],\n      bundle: true,\n      write: false,\n      plugins: [unpkgPathPlugin(), fetchPlugin(rawCode)],\n      define: {\n        \"process.env.NODE_ENV\": '\"production\"',\n        global: \"window\", // automatically done by webpack :(\n      },\n      jsxFactory: \"_React.createElement\",\n      jsxFragment: \"_React.Fragment\",\n    })\n    return {\n      code: result.outputFiles[0].text,\n      err: \"\",\n    }\n  } catch (err: any) {\n    return {\n      code: \"\",\n      err: err.message,\n    }\n  }\n}\n\nexport default bundle\n"]},"metadata":{},"sourceType":"module"}